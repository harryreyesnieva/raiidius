---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import ComingSoonBanner from "../../../components/ComingSoonBanner.astro";
import Button from "../../../components/ui/Button.astro";
import Card from "../../../components/ui/Card.astro";
import Badge from "../../../components/ui/Badge.astro";
import Separator from "../../../components/ui/Separator.astro";
import Icon from "../../../components/Icon.astro";
import { siteConfig, getEdition } from "../../../content/siteConfig";
import { getEditionYears } from "../../../lib/editions";

export async function getStaticPaths() {
  return getEditionYears().map((year) => ({ params: { year: String(year) } }));
}

const year = Number(Astro.params.year);
const edition = getEdition(year) ?? siteConfig.editions[0];

const canSubmit = Boolean(edition.submissionUrl) && !edition.isComingSoon;
const topics = (edition.themes ?? []).map((t) => t.title);
const faqs = edition.faqs ?? [];
---
<BaseLayout
  year={year}
  title="Abstracts & Posters"
  description={`Submit an abstract or poster for ${siteConfig.seriesAcronym} ${edition.year}.`}
>
  <section class="border-b border-border px-4 py-12 lg:px-6">
    <div class="mx-auto max-w-7xl">
      <div class="flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
        <div>
          <h1 class="text-3xl font-bold text-foreground">Abstracts & Posters</h1>
          <p class="mt-2 text-sm text-muted-foreground">
            Submit your work on responsible AI and informatics for infectious diseases—featuring a strong trainee showcase.
          </p>
        </div>
        <div class="print:hidden">
          <Button href={canSubmit ? edition.submissionUrl : undefined} disabled={!canSubmit} variant="primary">
            Submit
            <Icon name="ArrowRight" class="h-4 w-4" />
          </Button>
        </div>
      </div>

      {edition.isComingSoon ? (
        <div class="mt-6">
          <ComingSoonBanner year={edition.year} theme={edition.themeTitle} />
        </div>
      ) : null}

      <div class="mt-10 grid gap-6 lg:grid-cols-3">
        <div class="lg:col-span-2">
          <h2 class="text-xl font-semibold text-foreground">Topics of interest</h2>
          <p class="mt-2 text-sm text-muted-foreground">
            Align your submission with the symposium themes. Cross-cutting work (ethics, equity, implementation) is encouraged.
          </p>

          <div class="mt-4 flex flex-wrap gap-2">
            {topics.map((t) => (
              <Badge variant="secondary">{t}</Badge>
            ))}
          </div>

          <Separator class="my-8" />

          <h2 class="text-xl font-semibold text-foreground">Submission guidelines</h2>
          <div class="mt-4 grid gap-4">
            <Card>
              <div class="p-6">
                <div class="text-sm font-semibold text-foreground">Formats</div>
                <ul class="mt-2 grid gap-2 text-sm text-muted-foreground">
                  <li>• Poster (default; trainee showcase)</li>
                  <li>• Oral (limited slots; by invitation or top-scoring abstracts)</li>
                </ul>
              </div>
            </Card>

            <Card>
              <div class="p-6">
                <div class="text-sm font-semibold text-foreground">Word limits (placeholder)</div>
                <ul class="mt-2 grid gap-2 text-sm text-muted-foreground">
                  <li>• Abstract body: up to 300–500 words</li>
                  <li>• Include: Objectives, Methods, Results, Conclusions (as applicable)</li>
                </ul>
              </div>
            </Card>

            <Card>
              <div class="p-6">
                <div class="text-sm font-semibold text-foreground">Categories (placeholder)</div>
                <div class="mt-2 flex flex-wrap gap-2">
                  <Badge variant="outline">Diagnostics</Badge>
                  <Badge variant="outline">Surveillance</Badge>
                  <Badge variant="outline">Predictive modeling</Badge>
                  <Badge variant="outline">Implementation</Badge>
                  <Badge variant="outline">Ethics / equity</Badge>
                  <Badge variant="outline">Patient engagement</Badge>
                </div>
              </div>
            </Card>

            <Card>
              <div class="p-6">
                <div class="text-sm font-semibold text-foreground">Review criteria (placeholder)</div>
                <ul class="mt-2 grid gap-2 text-sm text-muted-foreground">
                  <li>• Relevance to infectious diseases and the edition theme</li>
                  <li>• Scientific/technical rigor and clarity</li>
                  <li>• Responsible AI considerations (ethics, bias, equity)</li>
                  <li>• Implementation feasibility and real-world constraints</li>
                </ul>
              </div>
            </Card>
          </div>

          <Separator class="my-8" />

          <h2 class="text-xl font-semibold text-foreground">Trainee emphasis & poster logistics</h2>
          <p class="mt-2 text-sm text-muted-foreground">
            Trainees are strongly encouraged to submit. Posters will be highlighted during the lunch and afternoon poster sessions.
            Logistics (dimensions, setup times, judging) will be posted here (placeholders for now).
          </p>
        </div>

        <aside>
          <Card>
            <div class="p-6">
              <div class="text-sm font-semibold text-foreground">Key dates</div>
              <p class="mt-2 text-sm text-muted-foreground">
                Submission deadlines and notifications will be announced here (placeholders).
              </p>
              <div class="mt-3 grid gap-2 text-sm text-muted-foreground">
                <div>• Submission deadline: TBD</div>
                <div>• Notification: TBD</div>
                <div>• Final materials: TBD</div>
              </div>
            </div>
          </Card>

          <div class="mt-4 rounded-lg border border-border bg-primary/5 p-6">
            <div class="text-sm font-semibold text-foreground">Questions?</div>
            <p class="mt-2 text-sm text-muted-foreground">
              Email the organizers at <a class="underline underline-offset-4 hover:text-foreground" href={`mailto:${edition.contactEmail}`}>{edition.contactEmail}</a>.
            </p>
          </div>
        </aside>
      </div>

      {faqs.length ? (
        <>
          <Separator class="my-12" />
          <h2 class="text-xl font-semibold text-foreground">FAQ</h2>
          <div class="mt-4 grid gap-3">
            {faqs.map((f) => (
              <details class="rounded-lg border border-border bg-background p-4">
                <summary class="cursor-pointer text-sm font-semibold text-foreground">{f.question}</summary>
                <p class="mt-2 text-sm text-muted-foreground">{f.answer}</p>
              </details>
            ))}
          </div>
        </>
      ) : null}
    </div>
  </section>
</BaseLayout>
