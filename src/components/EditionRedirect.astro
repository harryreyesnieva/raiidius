---
import { siteConfig, getActiveEdition } from "../content/siteConfig";

export interface Props {
  suffix?: string; // e.g., "program/"
  defaultYear?: number;
}

const { suffix = "", defaultYear } = Astro.props;
const baseUrl = import.meta.env.BASE_URL; // includes trailing slash
const defaultTarget = defaultYear ?? getActiveEdition().year ?? siteConfig.editions[0].year;
const safeSuffix = suffix.startsWith("/") ? suffix.slice(1) : suffix;
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="robots" content="noindex" />
    <meta http-equiv="refresh" content={`0;url=${baseUrl}${defaultTarget}/${safeSuffix}`} />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Redirecting…</title>
  </head>
  <body>
    <p>Redirecting…</p>
    <script is:inline>
      const STORAGE_KEY = "raiidiusEditionYear";
      const base = {JSON.stringify(baseUrl)}.replace(/\/$/, "");
      const suffix = "{safeSuffix}";
      const fallback = {defaultTarget};
      let y = fallback;
      try {
        const saved = Number(localStorage.getItem(STORAGE_KEY));
        if (Number.isFinite(saved) && saved) y = saved;
      } catch {}
      const target = `${base}/${y}/${suffix}`;
      window.location.replace(target);
    </script>
  </body>
</html>
