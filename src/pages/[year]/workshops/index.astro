---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import ComingSoonBanner from "../../../components/ComingSoonBanner.astro";
import Card from "../../../components/ui/Card.astro";
import Badge from "../../../components/ui/Badge.astro";
import Separator from "../../../components/ui/Separator.astro";
import Button from "../../../components/ui/Button.astro";
import Icon from "../../../components/Icon.astro";
import { siteConfig, getEdition, getSpeakerById } from "../../../content/siteConfig";
import { getEditionYears } from "../../../lib/editions";

export async function getStaticPaths() {
  return getEditionYears().map((year) => ({ params: { year: String(year) } }));
}

const year = Number(Astro.params.year);
const edition = getEdition(year) ?? siteConfig.editions[0];

const workshops = edition.workshops ?? [];
---
<BaseLayout year={year} title="Workshops" description={`Workshops for ${siteConfig.seriesAcronym} ${edition.year}.`}>
  <section class="border-b border-border px-4 py-12 lg:px-6">
    <div class="mx-auto max-w-7xl">
      <div class="flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
        <div>
          <h1 class="text-3xl font-bold text-foreground">Workshops</h1>
          <p class="mt-2 text-sm text-muted-foreground">
            Hands-on sessions and tutorials (where available). Details may evolve.
          </p>
        </div>
        <div class="print:hidden">
          <Button href={`${import.meta.env.BASE_URL}${year}/register/`} variant="outline">
            Register
            <Icon name="ArrowRight" class="h-4 w-4" />
          </Button>
        </div>
      </div>

      {edition.isComingSoon ? (
        <div class="mt-6">
          <ComingSoonBanner year={edition.year} theme={edition.themeTitle} />
        </div>
      ) : null}

      {workshops.length ? (
        <div class="mt-10 grid gap-4 md:grid-cols-2">
          {workshops.map((w) => (
            <Card class="h-full">
              <div class="p-6">
                <div class="flex flex-wrap items-center gap-2">
                  <div class="text-lg font-semibold text-foreground">{w.title}</div>
                  {w.level ? <Badge variant="secondary">{w.level}</Badge> : null}
                  {w.format ? <Badge variant="outline">{w.format}</Badge> : null}
                </div>

                <p class="mt-2 text-sm text-muted-foreground">{w.description}</p>

                {w.instructors?.length ? (
                  <p class="mt-3 text-sm text-muted-foreground">
                    <span class="font-medium text-foreground">Instructors:</span>{" "}
                    {w.instructors
                      .map((id) => getSpeakerById(edition, id)?.name ?? id)
                      .join(", ")}
                  </p>
                ) : null}

                {w.time ? (
                  <div class="mt-4 text-sm text-muted-foreground">
                    <span class="font-medium text-foreground">Time:</span> {w.time}
                  </div>
                ) : null}
              </div>
            </Card>
          ))}
        </div>
      ) : (
        <div class="mt-10 rounded-lg border border-border bg-background p-10 text-center text-sm text-muted-foreground">
          Workshops will appear here when announced.
        </div>
      )}

      <Separator class="my-12" />
      <div class="text-sm text-muted-foreground">
        Have an idea for a tutorial? Email <a class="underline underline-offset-4 hover:text-foreground" href={`mailto:${edition.contactEmail}`}>{edition.contactEmail}</a>.
      </div>
    </div>
  </section>
</BaseLayout>
