---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import ComingSoonBanner from "../../../components/ComingSoonBanner.astro";
import Button from "../../../components/ui/Button.astro";
import Card from "../../../components/ui/Card.astro";
import Badge from "../../../components/ui/Badge.astro";
import Separator from "../../../components/ui/Separator.astro";
import Icon from "../../../components/Icon.astro";
import { siteConfig, getEdition } from "../../../content/siteConfig";
import { getEditionYears } from "../../../lib/editions";

export async function getStaticPaths() {
  return getEditionYears().map((year) => ({ params: { year: String(year) } }));
}

const year = Number(Astro.params.year);
const edition = getEdition(year) ?? siteConfig.editions[0];
const canRegister = Boolean(edition.registrationUrl) && !edition.isComingSoon;
---
<BaseLayout year={year} title="Register" description={`Register for ${siteConfig.seriesAcronym} ${edition.year}.`}>
  <section class="border-b border-border px-4 py-12 lg:px-6">
    <div class="mx-auto max-w-7xl">
      <div class="flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
        <div>
          <h1 class="text-3xl font-bold text-foreground">Register</h1>
          <p class="mt-2 text-sm text-muted-foreground">
            Secure your spot for {siteConfig.seriesAcronym} {edition.year}. Space may be limited.
          </p>
        </div>
        <div class="print:hidden">
          <Button href={canRegister ? edition.registrationUrl : undefined} disabled={!canRegister} variant="primary">
            Register now
            <Icon name="ArrowRight" class="h-4 w-4" />
          </Button>
        </div>
      </div>

      {edition.isComingSoon ? (
        <div class="mt-6">
          <ComingSoonBanner year={edition.year} theme={edition.themeTitle} />
        </div>
      ) : null}

      <div class="mt-10 grid gap-6 lg:grid-cols-3">
        <div class="lg:col-span-2">
          <Card>
            <div class="p-6">
              <div class="text-sm font-semibold text-foreground">Registration tiers (placeholders)</div>
              <p class="mt-2 text-sm text-muted-foreground">
                Final pricing and tiers will be posted here. Typical tiers include trainee/student, faculty/staff, and external attendees.
              </p>

              <div class="mt-4 grid gap-3 md:grid-cols-3">
                <div class="rounded-lg border border-border bg-background p-4">
                  <Badge variant="secondary">Trainee</Badge>
                  <div class="mt-2 text-sm text-muted-foreground">TBD</div>
                </div>
                <div class="rounded-lg border border-border bg-background p-4">
                  <Badge variant="secondary">Academic</Badge>
                  <div class="mt-2 text-sm text-muted-foreground">TBD</div>
                </div>
                <div class="rounded-lg border border-border bg-background p-4">
                  <Badge variant="secondary">Industry / External</Badge>
                  <div class="mt-2 text-sm text-muted-foreground">TBD</div>
                </div>
              </div>

              <Separator class="my-6" />

              <div class="text-sm font-semibold text-foreground">Cancellation & refund policy (placeholder)</div>
              <p class="mt-2 text-sm text-muted-foreground">
                Add cancellation/refund language here (e.g., refunds until X date, substitutions allowed, etc.).
              </p>

              <Separator class="my-6" />

              <div class="text-sm font-semibold text-foreground">Accessibility & accommodations</div>
              <p class="mt-2 text-sm text-muted-foreground">
                If you require accommodations (mobility, vision/hearing, lactation space, dietary needs), email
                <a class="ml-1 underline underline-offset-4 hover:text-foreground" href={`mailto:${edition.contactEmail}`}>{edition.contactEmail}</a>.
              </p>
            </div>
          </Card>
        </div>

        <aside class="grid gap-4">
          <Card>
            <div class="p-6">
              <div class="text-sm font-semibold text-foreground">Venue</div>
              <p class="mt-2 text-sm text-muted-foreground">
                {edition.venue}<br />
                {edition.address}<br />
                {edition.city}, {edition.state} {edition.zip}
              </p>
              <div class="mt-4">
                <Button href={`${import.meta.env.BASE_URL}${year}/venue/`} variant="outline">
                  Venue details
                  <Icon name="ArrowRight" class="h-4 w-4" />
                </Button>
              </div>
            </div>
          </Card>

          <div class="rounded-lg border border-border bg-primary/5 p-6">
            <div class="text-sm font-semibold text-foreground">Need help?</div>
            <p class="mt-2 text-sm text-muted-foreground">
              Email <a class="underline underline-offset-4 hover:text-foreground" href={`mailto:${edition.contactEmail}`}>{edition.contactEmail}</a>.
            </p>
          </div>
        </aside>
      </div>
    </div>
  </section>
</BaseLayout>
